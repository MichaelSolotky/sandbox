\documentclass[unicode]{article}

\usepackage[russian]{babel}
\usepackage[cp1251]{inputenc}
\usepackage{color}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{graphics}
\usepackage{epsfig}
\usepackage[colorlinks,urlcolor=blue]{hyperref}

\textheight=24cm
\textwidth=18cm
\oddsidemargin=-1cm
\topmargin=-2.5cm
\sloppy

\newcounter{example}

\def\vec#1{\mathchoice{\mbox{\boldmath$\displaystyle#1$}}
{\mbox{\boldmath$\textstyle#1$}} {\mbox{\boldmath$\scriptstyle#1$}} {\mbox{\boldmath$\scriptscriptstyle#1$}}}

\newcommand{\tr}{\mathop{\mathrm{tr}}\limits}

\DeclareMathOperator{\R}{U}
\DeclareMathOperator{\B}{Beta}
\DeclareMathOperator{\Par}{Pareto}

\renewcommand{\labelitemi}{$-$}

\pagestyle{empty}

\title{Теоретическое задание по вариационному выводу}
\author{Солоткий Михаил, 417 группа ВМК МГУ}

\begin{document}
\maketitle

Пусть $X=\{\vec{x}_1,\dots,\vec{x}_N\}$, $\vec{x}_n\in\mathbb{R}^D$~-- независимая выборка из смеси распределений Стьюдента
\begin{equation}
    p(\vec{x}) = \sum_{k=1}^Kw_k\mathcal{T}(\vec{x}|\vec{\mu}_k,\Sigma_k,\nu),\quad w_k\ge 0,\ \sum_jw_j=1.
    \label{eq:student_mix}
\end{equation}
Рассмотрим следующую вероятностную модель со скрытыми переменными:
\begin{equation}
    p(X, T, Z|\vec{w},\vec{\mu},\Sigma,\nu) = \prod_{n,k=1}^{N,K}\biggl[w_k\mathcal{N}(\vec{x}_n|\vec{\mu}_k,\Sigma_k/z_n)\mathcal{G}(z_n|\nu/2,\nu/2)\biggr]^{t_{nk}}.
    \label{eq:full_model}
\end{equation}
Здесь $t_{nk}\in\{0,1\}$, $\sum_jt_{nj}=1$ обозначает принадлежность $n$-го объекта $k$-ой компоненте смеси. Очевидно, что неполное правдоподобие $p(X|\vec{w},\vec{\mu},\Sigma,\nu)$ для модели~\eqref{eq:full_model} совпадает с правдоподобием выборки $X$ для смеси~\eqref{eq:student_mix}. Поэтому оценки максимального правдоподобия $w_{ML,k}, \mu_{ML,k}, \Sigma_{ML,k}$ для смеси~\eqref{eq:student_mix} можно искать с помощью вариационного ЕМ-алгоритма для модели~\eqref{eq:full_model}, в котором на Е-шаге апостериорное распределение приближается в семействе
$$
    q_T(T)q_Z(Z)\approx p(T,Z|X,\vec{w},\vec{\mu},\Sigma,\nu).
$$
Для выполнения задания требуется:
\begin{enumerate}
    \item Выписать формулы пересчёта для компонент вариационного приближения $q_T(T)$ и $q_Z(Z)$;
    \item Выписать формулы пересчёта параметров $w_k,\mu_k,\Sigma_k$ на М-шаге. Убедиться, что эти формулы переходят в соответствующие формулы с семинара по ЕМ-алгоритму для случая $K=1$;
    \item Расписать функционал $\mathcal{L}(q,\vec{w},\vec{\mu},\Sigma)$~-- нижнюю оценку на $\log p(X|\vec{w},\vec{\mu},\Sigma,\nu)$;
    \item Найти формулы для статистик распределений $q_T(T)$ и $q_Z(Z)$, требуемых в предыдущих трёх пунктах.
\end{enumerate}
Решение:
\begin{enumerate}
        \item После выполнения очередной итерации mean-field аппроксимации распределение $q_T$ останется категориальным (носитель не меняется, оно не сможет стать другим). Т. к. априорное гамма-распределение и нормальная функция правдоподобия сопряжены при переменном множителе в ковариационной матрице, после mean-field аппроксимации $q_Z$ будет гамма-распределением.
    Функция вероятности априорного распределения на переменные $T$ факторизуется в произведение по объектам: $P(T) = \prod\limits_{n=1}^N P(t_n)$; $P(t_n = k) = w_k$ \\
    В результате mean-field аппроксимации $q_T(T)$ по-прежнему будет факторизоваться по объектам (это будет показано дальше). Сейчас выведем формулы для распределения $q_Z$ и покажем, что оно тоже факторизуется по объектам. \\
    $q_T(T) = \prod\limits_{n=1}^N q_n(t_n)$, где $t_n$ - индекс компоненты для n-того объекта; \\
    $q_Z(Z) = \cfrac{\exp\{ \mathbb{E}_{q_T} \ln p(X, T, Z | \vec{w}, \vec{\mu}, \Sigma, \nu) \}}{\int \exp\{ \mathbb{E}_{q_T} \ln p(X, T, Z | \vec{w}, \vec{\mu}, \Sigma, \nu) \} dZ}$ \\
    $p(X, T, Z | \vec{w}, \vec{\mu}, \Sigma, \nu) =$
    $\prod\limits_{n=1}^N w_{t_n} \mathcal{N} ( \vec{x}_n | \vec{\mu}_{t_n}, \cfrac{\Sigma_{t_n}}{z_n} ) \mathcal{G}(z_n | \frac{\nu}{2}, \frac{\nu}{2})$ \\
    $\ln p(X, T, Z | \vec{w}, \vec{\mu}, \Sigma, \nu) =$
    $\sum\limits_{n=1}^N \ln w_{t_n} + \ln \mathcal{N} ( \vec{x}_n | \vec{\mu}_{t_n}, \cfrac{\Sigma_{t_n}}{z_n} ) + \ln \mathcal{G}(z_n | \frac{\nu}{2}, \frac{\nu}{2})$ \\
    $\mathbb{E}_{q_T} \ln p(X, T, Z | \vec{w}, \vec{\mu}, \Sigma, \nu) =
    \sum\limits_{n=1}^N \sum\limits_{k=1}^K q_n(t_n = k) \ln w_k - \frac{N D}{2} \ln(2 \pi) - \frac{1}{2} \sum\limits_{n=1}^N \sum\limits_{k=1}^K q_n(t_n = k) \ln \det \Sigma_{t_n} + \\ + \frac{D}{2} \sum\limits_{n=1}^N \ln z_n - \frac{1}{2} \sum\limits_{n=1}^N z_n \sum\limits_{k=1}^K q_n(t_n = k) (\vec{x}_n - \vec{\mu}_k)^T \Sigma_k^{-1} (\vec{x}_n - \vec{\mu}_k) + \sum\limits_{n=1}^N \ln \mathcal{G}(z_n | \frac{\nu}{2}, \frac{\nu}{2})$ \\
    $c_1 = \exp \Big\{ \sum\limits_{n=1}^N \sum\limits_{k=1}^K q_n(t_n = k) \ln w_k \Big\} \exp \Big\{ -\frac{N D}{2} \ln(2 \pi) \Big\} \exp \Big\{ -\frac{1}{2} \sum\limits_{n=1}^N \sum\limits_{k=1}^K q_n(t_n = k) \ln \det \Sigma_{t_n} \Big\} \\
    c_{n2}(x_n) = \sum\limits_{k=1}^K q_n(t_n=k) ( \vec{x}_n - \vec{\mu}_k)^T \Sigma^{-1}_k (\vec{x}_n - \vec{\mu}_k) \\
    \exp \Big\{ \mathbb{E}_{q_T} \ln p(X, T, Z | \vec{w}, \vec{\mu}, \Sigma, \nu) \Big\} =
    c_1 \prod\limits_{n=1}^N \Big[ z_n^{\frac{D}{2}} \exp \Big\{-\frac{1}{2} z_n c_{2n}(x_n) \Big\} \mathcal{G}(z_n | \frac{\nu}{2}, \frac{\nu}{2}) \Big] = \\
    = \Bigg\{ \mathcal{G}(z | a, b) = \cfrac{b^a}{\Gamma(a)} z^{a-1} e^{ -b z} \Bigg\} =
    \prod\limits_{n=1}^N c_{3n} z_n^{\frac{D + \nu}{2} - 1} \exp \Big\{ -\frac{1}{2} z_n (c_{2n}(x_n) + \nu) \Big\} \\
    q_Z(Z) = \prod\limits_{n=1}^N \cfrac{ \Big( \frac{1}{2} (c_{2n}(x_n) + \nu) \Big)^{\frac{D + \nu}{2}}}{\Gamma(\frac{D + \nu}{2})} z_n^{\frac{D + \nu}{2}} \exp \Big\{ -\frac{1}{2} z_n (c_{2n}(x_n) + \nu) \Big\}$ \\ \\

    $q_T(T) = \cfrac{\exp\{ \mathbb{E}_{q_Z} \ln p(X, T, Z | \vec{w}, \vec{\mu}, \Sigma, \nu) \}}{\int \exp\{ \mathbb{E}_{q_Z} \ln p(X, T, Z | \vec{w}, \vec{\mu}, \Sigma, \nu) \} dT}$ \\
    $\ln p(X, T, Z | \vec{w}, \vec{\mu}, \Sigma, \nu) =$
    $\sum\limits_{n=1}^N \Big[ \ln w_{t_n} + \ln \mathcal{N} (\vec{x}_n | \vec{\mu_{t_n}}, \cfrac{\Sigma_{t_n}}{z_n}) + \ln \mathcal{G}(z_n | \frac{\nu}{2}, \frac{\nu}{2}) \Big] =$ \\
    $\mathbb{E}_{q_Z} \ln p(X, T, Z | \vec{w}, \vec{\mu}, \Sigma, \nu) =$
    $\sum\limits_{n=1}^N \ln w_{t_n} -\frac{N D}{2} \ln(2 \pi) - \frac{1}{2} \sum\limits_{n=1}^N \ln \det \Sigma_{t_n} + \frac{D}{2} \sum\limits_{n=1}^N \mathbb{E}_{q_Z} \ln z_n - \\ - \frac{1}{2} \sum\limits_{n=1}^N \mathbb{E}_{q_Z} z_n (\vec{x}_n - \vec{\mu}_{t_n})^T \Sigma_{t_n}^{-1} (\vec{x}_n - \vec{\mu}_{t_n}) + \frac{N \nu}{2} \ln\frac{\nu}{2} - N \ln \Gamma(\frac{\nu}{2}) + (\frac{\nu}{2} - 1) \sum\limits_{n=1}^N \mathbb{E}_{z_n} \ln z_n - \frac{\nu}{2} \sum\limits_{n=1}^N \mathbb{E}_{z_n} z_n =$ \\
    $= \Bigg\{ z_n \sim \mathcal{G}(z_n | a_n, b_n) \Bigg\} =$
    $\sum\limits_{n=1}^N \ln w_{t_n} - \frac{N D}{2} \ln(2 \pi) - \frac{1}{2} \sum\limits_{n=1}^N \ln \det \Sigma_{t_n} + \frac{D}{2} \sum\limits_{n=1}^N \Bigg[ \cfrac{\Gamma^{'}(a_n)}{\Gamma(a_n)} - \ln b_n \Bigg] - \\ - \frac{1}{2} \sum\limits_{n=1}^N \cfrac{a_n}{b_n} (\vec{x}_n - \vec{\mu}_{t_n})^T \Sigma_{t_n}^{-1} (\vec{x}_n - \vec{\mu}_{t_n}) + \frac{N \nu}{2} \ln \frac{\nu}{2} - N \ln \Gamma(\frac{\nu}{2}) + (\frac{\nu}{2} - 1)\sum\limits_{n=1}^N \Bigg[ \cfrac{\Gamma^{'}(a_n)}{\Gamma(a_n)} - \ln b_n \Bigg] -\frac{\nu}{2} \sum\limits_{n=1}^N \frac{a_n}{b_n}$ \\
    $c_1 = (2 \pi)^{\frac{-N D}{2}} \frac{\nu}{2}^{\frac{N \nu}{2}} (\Gamma(\frac{\nu}{2}))^{-N}
    \exp \Big\{ \Big( \frac{D + \nu}{2} - 1 \Big) \sum\limits_{n=1}^N \Bigg[ \cfrac{\Gamma(a_n)^{'}}{\Gamma(a_n)} - \ln b_n \Bigg] -\frac{\nu}{2} \sum\limits_{n=1}^N \frac{a_n}{b_n} \Big\}$ \\
    $\exp \Big\{ \mathbb{E}_{q_Z} \ln p(X, T, Z | \vec{w}, \vec{\mu}, \Sigma, \nu) \Big\} =$
    $c_1 \prod\limits_{n=1}^N w_{t_n} \prod\limits_{n=1}^N \cfrac{1}{\sqrt{\det \Sigma_{t_n}}} \prod\limits_{n=1}^N \exp \Big\{ -\cfrac{1}{2} \cfrac{a_n}{b_n} (\vec{x}_n - \vec{\mu}_{t_n})^T \Sigma_{t_n}^{-1} (\vec{x}_n - \vec{\mu}_{t_n}) \Big\}$ \\
    $\int \exp \Big\{ \mathbb{E}_{q_Z} \ln p(X, T, Z | \vec{w}, \vec{\mu}, \Sigma, \nu) \Big\} dT =$
    $\sum\limits_{t_1 \dots t_n \in \mathcal{D}(t_1 \dots t_n)} \exp \Big\{ \mathbb{E}_{q_Z} \ln p(X, T, Z | \vec{w}, \vec{\mu}, \Sigma, \nu) \Big\} =$ \\
    $= c_1 \sum\limits_{t_1 \dots t_n \in \mathcal{D}(t_1 \dots t_n)} \prod\limits_{n=1}^N w_{t_n} \prod\limits_{n=1}^N \cfrac{1}{\sqrt{\det \Sigma_{t_n}}} \prod\limits_{n=1}^N \exp \Big\{ -\cfrac{1}{2} \cfrac{a_n}{b_n} (\vec{x}_n - \vec{\mu}_{t_n})^T \Sigma_{t_n}^{-1} (\vec{x}_n - \vec{\mu}_{t_n}) \Big\}$ \\
    $f(t_n) = w_{t_n} \cfrac{1}{\sqrt{\det \Sigma_{t_n}}} \exp \Big\{ -\cfrac{1}{2} \cfrac{a_n}{b_n} (\vec{x}_n - \vec{\mu}_{t_n})^T \Sigma_{t_n}^{-1} (\vec{x}_n - \vec{\mu}_{t_n}) \Big\}$ \\
    $\sum\limits_{t_1 \dots t_n \in \mathcal{D}(t_1 \dots t_n)} \exp \Big\{ \mathbb{E}_{q_Z} \ln p(X, T, Z | \vec{w}, \vec{\mu}, \Sigma, \nu) \Big\} =$
    $\sum\limits_{t_1 \dots t_n \in \mathcal{D}(t_1 \dots t_n)} c_1 \prod\limits_{n=1}^N f(t_n) =$ \\
    $= c_1 \sum\limits_{t_1 \in \mathcal{D}(t_1)} \sum\limits_{t_2 \dots t_n \in \mathcal{D}(t_2 \dots t_n)} f(t_1) \prod\limits_{n=2}^N f(t_n) =$
    $c_1 \sum\limits_{t_2 \dots t_n \in \mathcal{D}(t_2 \dots t_n)} \Bigg( \sum\limits_{t_1 \in \mathcal{D}(t_1)} f(t_1) \Bigg) \prod\limits_{n=2}^N f(t_n) =$
    $c_1 \prod\limits_{n=1}^N \sum\limits_{t_n \in \mathcal{D}(t_n)} f(t_n)$ \\
    $q_T(T) = \cfrac{ \prod\limits_{n=1}^N f(t_n) }{ \prod\limits_{n=1}^N \sum\limits_{t_n \in \mathcal{D}(t_n)} f(t_n)}$
    \item $q = q_T q_Z$ \\
    $q_T(T) = \prod\limits_{n=1}^N q_n(t_n)$, где $t_n$ - индекс компоненты для n-того объекта; \\
    $\mathcal{L}(q, \vec{w}, \vec{\mu}, \Sigma) =$
    $\mathbb{E}_q \ln p(X, T, Z | \vec{w}, \vec{\mu}, \Sigma, \nu) =$
    $\sum\limits_{n=1}^N \mathbb{E}_q \Big[ \ln w_{t_n} - \frac{D}{2} \ln(2 \pi) - \frac{1}{2} \ln \det \Sigma_{t_n} + \frac{D}{2} \ln z_n - \\ - \frac{1}{2} z_n (\vec{x}_n - \vec{\mu}_{t_n})^T \Sigma_{t_n}^{-1} (\vec{x}_n - \vec{\mu}_{t_n})  + \frac{\nu}{2} ln \frac{\nu}{2} - \ln \Gamma(\frac{\nu}{2}) + \Big(\frac{\nu}{2} - 1 \Big) \ln z_n - \frac{\nu}{2} z_n \Big] =$
    $\sum\limits_{n=1}^N \sum\limits_{k=1}^K q_n(k) \ln w_k - \frac{N D}{2} \ln(2 \pi) -\frac{1}{2} \sum\limits_{n=1}^N \sum\limits_{k=1}^K q_n(k) \ln\det \Sigma_k + \frac{D}{2} \sum\limits_{n=1}^N \Big[ \cfrac{\Gamma^{'}(a_n)}{\Gamma(a_n)} - \ln b_n \Big] - \frac{1}{2} \sum\limits_{n=1}^N \frac{a_n}{b_n} \sum\limits_{k=1}^K q_n(k) (\vec{x}_n - \vec{\mu}_k)^T \Sigma_k^{-1} (\vec{x}_n - \vec{\mu}_k) + \frac{N \nu}{2} \ln \frac{\nu}{2} - \\ - N \ln \Gamma(\frac{\nu}{2}) +\Big(\frac{\nu}{2} - 1 \Big) \sum\limits_{n=1}^N \Bigg[ \cfrac{\Gamma^{'}(a_n)}{\Gamma(a_n)} - \ln b_n \Bigg] - \frac{\nu}{2} \sum\limits_{n=1}^N \frac{a_n}{b_n}$ \\
    $\begin{cases}
    	\mathcal{L}(q, \vec{w}, \vec{\mu}, \Sigma) \rightarrow \max\limits_{\vec{w}} \\
    w_k \geq 0\\
    \sum\limits_{k=1}^K w_k = 1
    \end{cases}$ \\
    ККТ: \\
    $L(w, \lambda, \mu) =$
    $\sum\limits_{n=1}^N \sum\limits_{k=1}^K q_n(k) \ln w_k + \sum\limits_{k=1}^K \lambda_k w_k - \mu \Bigg( \sum\limits_{k=1}^K w_k - 1 \Bigg)$ \\
    $\nabla_{w_k} L(w, \lambda, \mu) =$
    $\cfrac{\sum\limits_{n=1}^N q_n(k)}{w_k} + \lambda_k - \mu$ \\
    $\begin{cases}
    \nabla_{w_k} L(w, \lambda, \mu) = 0 \\
    w_k \geq 0 \\
    \sum\limits_{k=1}^K w_k = 1 \\
    \lambda_k \geq 0 \\
    \lambda_k w_k = 0
    \end{cases} \Leftrightarrow$
    $\begin{cases}
    \mu = \cfrac{\sum\limits_{n=1}^N q_n(k)}{w_k} \\
    w_k > 0 \\
    \sum\limits_{k=1}^K w_k = 1 \\
    \lambda_k = 0 \\
    \end{cases} \Rightarrow$
    $\begin{cases}
    w_k = \cfrac{\sum\limits_{n=1}^N q_n(k)}{\mu} \\
    \sum\limits_{k=1}^K w_k = 1
    \end{cases} \Rightarrow$
    $\mu = \sum\limits_{n=1}^N \sum\limits_{k=1}^K q_n(k) = N \Rightarrow$ \\
    $\Rightarrow w_k = \cfrac{1}{N} \sum\limits_{n=1}^N q_n(k)$ \\ \\

    $\mathcal{L}(q, \vec{w}, \vec{\mu}, \Sigma) \rightarrow \max\limits_{\vec{\mu}}$ \\
    $\nabla_{\vec{\mu}_k} \mathcal{L}(q, \vec{w}, \vec{\mu}, \Sigma) =$
    $\sum\limits_{n=1}^N \cfrac{a_n}{b_n} q_n(k) \nabla_{\vec{\mu}_k} [\vec{x}_n^T \Sigma_k^{-1} \vec{x}_n - 2 \vec{x}_n^T \Sigma_k^{-1} \vec{\mu}_k + \vec{\mu}_k^T \Sigma_k^{-1} \vec{\mu}_k] =$
    $2 \sum\limits_{n=1}^N \cfrac{a_n}{b_n} q_n(k) [-\Sigma_k^{-1} \vec{x}_n + \\ + \Sigma_k^{-1} \vec{\mu}_k] = 0 \Rightarrow$
    $\sum\limits_{n=1}^N \cfrac{a_n}{b_n} q_n(k) \vec{x}_n =$
    $\sum\limits_{n=1}^N \cfrac{a_n}{b_n} q_n(k) \vec{\mu}_k \Rightarrow$
    $\vec{\mu}_k =$
    $\cfrac{\sum\limits_{n=1}^N \cfrac{a_n}{b_n} q_n(k) \vec{x}_n}{\sum\limits_{n=1}^N \cfrac{a_n}{b_n} q_n(k)}$ \\ \\

    $\mathcal{L}(q, \vec{w}, \vec{\mu}, \Sigma) \rightarrow \max\limits_{\Sigma}$ \\
    $\nabla_{\Sigma_k^{-1}} \mathcal{L}(q, \vec{w}, \vec{\mu}, \Sigma) =$
    $\cfrac{1}{2} \sum\limits_{n=1}^N q_n(k) \Big[ \nabla_{\Sigma_k^{-1}} \ln\det\Sigma_k^{-1} - \cfrac{a_n}{b_n} \nabla_{\Sigma_k^{-1}} (\vec{x}_n - \vec{\mu}_k)^T \Sigma_k^{-1} (\vec{x}_n - \vec{\mu}_k) \Big] =$ \\
    $= \cfrac{1}{2} \sum\limits_{n=1}^N q_n(k) \Big[ \Sigma_k - \cfrac{a_n}{b_n} (\vec{x}_n - \vec{\mu}_k) (\vec{x}_n - \vec{\mu}_k)^T \Big] = 0 \Rightarrow$
    $\Sigma_k = \cfrac{\sum\limits_{n=1}^N \cfrac{a_n}{b_n} q_n(k) (\vec{x}_n - \vec{\mu}_k) (\vec{x}_n - \vec{\mu}_k)^T}{\sum\limits_{n=1}^N q_n(k)}$
    \item $q = q_T q_Z$ \\
    $q_T(T) = \prod\limits_{n=1}^N q_n(t_n)$, где $t_n$ - индекс компоненты для n-того объекта; \\
    $\mathcal{L}(q, \vec{w}, \vec{\mu}, \Sigma) =$
    $\mathbb{E}_q \ln p(X, T, Z | \vec{w}, \vec{\mu}, \Sigma, \nu) =$
    $\sum\limits_{n=1}^N \mathbb{E}_q \Big[ \ln w_{t_n} - \frac{D}{2} \ln(2 \pi) - \frac{1}{2} \ln \det \Sigma_{t_n} + \frac{D}{2} \ln z_n - \\ - \frac{1}{2} z_n (\vec{x}_n - \vec{\mu}_{t_n})^T \Sigma_{t_n}^{-1} (\vec{x}_n - \vec{\mu}_{t_n})  + \frac{\nu}{2} ln \frac{\nu}{2} - \ln \Gamma(\frac{\nu}{2}) + \Big(\frac{\nu}{2} - 1 \Big) \ln z_n - \frac{\nu}{2} z_n \Big] =$
    $\sum\limits_{n=1}^N \sum\limits_{k=1}^K q_n(k) \ln w_k - \frac{N D}{2} \ln(2 \pi) -\frac{1}{2} \sum\limits_{n=1}^N \sum\limits_{k=1}^K q_n(k) \ln\det \Sigma_k + \frac{D}{2} \sum\limits_{n=1}^N \Big[ \cfrac{\Gamma^{'}(a_n)}{\Gamma(a_n)} - \ln b_n \Big] - \frac{1}{2} \sum\limits_{n=1}^N \frac{a_n}{b_n} \sum\limits_{k=1}^K q_n(k) (\vec{x}_n - \vec{\mu}_k)^T \Sigma_k^{-1} (\vec{x}_n - \vec{\mu}_k) + \frac{N \nu}{2} \ln \frac{\nu}{2} - \\ - N \ln \Gamma(\frac{\nu}{2}) +\Big(\frac{\nu}{2} - 1 \Big) \sum\limits_{n=1}^N \Bigg[ \cfrac{\Gamma^{'}(a_n)}{\Gamma(a_n)} - \ln b_n \Bigg] - \frac{\nu}{2} \sum\limits_{n=1}^N \frac{a_n}{b_n}$ \\
    \item $\mathcal{G}(z_n | a_n, b_n) =$
    $\cfrac{b_n^{a_n}}{\Gamma(a_n)} z_n^{a_n - 1} e^{-b_n z_n}$ \\
    $\mathbb{E}_{z_n} z_n =$
    $\int\limits_0^{+\infty} \cfrac{b_n^{a_n}}{\Gamma(a_n)} z_n^{a_n} e^{-b_n z_n} dz_n =$
    $\int\limits_0^{+\infty} \cfrac{b_n^{a_n + 1} \Gamma(a_n + 1)}{b_n \Gamma(a_n) \Gamma(a_n + 1)} z_n^{a_n} e^{-b_n z_n} dz_n =$
    $\cfrac{a_n}{b_n} \int\limits_0^{+\infty} \cfrac{b_n^{a_n + 1}}{\Gamma(a_n + 1)} z_n^{a_n} e^{-b_n z_n} dz_n =$
    $\cfrac{a_n}{b_n}$ \\
    $\mathbb{E}_{z_n} \ln z_n = \int\limits_0^{+\infty} \ln z_n \cfrac{b_n^{a_n}}{\Gamma(a_n)} z_n^{a_n - 1} e^{-b_n z_n} dz_n =$
    $\Bigg\{ y_n = b_n z_n, z_n = \cfrac{y_n}{b_n} \Bigg\} =$
    $\int\limits_0^{+\infty} (\ln y_n - \ln b_n) \cfrac{b_n^{a_n}}{\Gamma(a_n)} \cfrac{y_n^{a_n - 1}}{b_n^{a_n - 1}} e^{y_n} \cfrac{1}{b_n}dy_n =$ \\
    $= \cfrac{1}{\Gamma(a_n)} \int\limits_o^{+\infty} y_n^{a_n - 1} e^{-y_n} \ln y_n dy_n - \ln b_n =$
    $\cfrac{1}{\Gamma(a_n)} \cfrac{d}{da_n} \int\limits_0^{+\infty} y_n^{a_n - 1} e^{-y_n} dy_n - \ln b_n =$
    $\cfrac{\Gamma^{'}(a_n)}{\Gamma(a_n)} - \ln b_n$
\end{enumerate}
\end{document}
